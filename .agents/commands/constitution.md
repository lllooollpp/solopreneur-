---
description: 创建或更新项目宪章，确保所有依赖模板同步。
---

## 用户输入

```text
$ARGUMENTS
```

请务必在分析前充分考虑用户输入（如有）。

## 目标

更新位于 `/memory/constitution.md` 的项目宪章。该文件为包含方括号占位符的模板（如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。任务是：(a) 收集/推导具体值，(b) 精确填充模板，(c) 将修订传播到依赖构件。

按照以下执行流程：

1. 加载位于 `/memory/constitution.md` 的现有宪章模板。
   - 识别所有形如 `[ALL_CAPS_IDENTIFIER]` 的占位符标记。
   **重要**：用户可能需要比模板中使用的原则更少或更多的原则。如果指定了数量，请遵循该数量 - 使用通用模板。您将相应地更新文档。

2. 收集/推导占位符的值：
   - 如果用户输入（对话）提供了值，则使用该值。
   - 否则从现有存储库上下文推断（README、文档、先前的宪章版本等）。
   - 对于治理日期：`RATIFICATION_DATE` 是原始采用日期（如果未知则询问或标记 TODO），`LAST_AMENDED_DATE` 是进行更改时的今天日期，否则保持之前的日期。
   - `CONSTITUTION_VERSION` 必须根据语义化版本规则递增：
     - MAJOR（主版本）：不向后兼容的治理/原则删除或重新定义。
     - MINOR（次版本）：添加新原则/部分或实质性扩展指导。
     - PATCH（补丁）：澄清、措辞、错别字修复、非语义改进。
   - 如果版本升级类型不明确，请在最终确定前提出推理。

3. 起草更新的宪章内容：
   - 用具体文本替换每个占位符（不留下方括号标记，除非项目选择不定义的故意保留模板槽 - 明确证明任何保留的理由）。
   - 保持标题层次结构，替换后的注释可以删除，除非它们仍然添加澄清指导。
   - 确保每个原则部分：简洁的名称行、段落（或项目符号列表）包含不可协商的规则、如果不明显则明确说明理由。
   - 确保治理部分列出修正程序、版本控制政策和合规审查期望。

4. 一致性传播检查清单（将先前检查清单转换为主动验证）：
   - 读取 `/templates/plan-template.md` 并确保任何"宪章检查"或规则与更新的原则保持一致。
   - 读取 `/templates/spec-template.md` 进行范围/需求对齐 - 如果宪章添加/删除强制部分或约束，则更新。
   - 读取 `/templates/tasks-template.md` 并确保任务分类反映新的或删除的原则驱动任务类型（例如，可观察性、版本控制、测试纪律）。
   - 读取 `/templates/commands/*.md` 中的每个命令文件（包括这个）以验证在需要通用指导时不存在过时的引用（仅限特定代理名称如 CLAUDE）。
   - 读取任何运行时指导文档（例如，`README.md`、`docs/quickstart.md` 或特定代理指导文件如果存在）。更新对已更改原则的引用。

5. 生成同步影响报告（在更新后以 HTML 注释形式前置到宪章文件顶部）：
   - 版本更改：旧版本 → 新版本
   - 修改原则列表（如果重命名，旧标题 → 新标题）
   - 添加的部分
   - 删除的部分
   - 需要更新的模板（✅ 已更新 / ⚠ 待处理）及文件路径
   - 如果任何占位符故意延迟的后续 TODO。

6. 最终输出前的验证：
   - 没有剩余的未解释方括号标记。
   - 版本行与报告匹配。
   - 日期使用 ISO 格式 YYYY-MM-DD。
   - 原则是声明性的、可测试的，且无模糊语言（"should" → 在适当的地方替换为 MUST/SHOULD 理由）。

7. 将完成的宪章写回 `/memory/constitution.md`（覆写）。

8. 向用户输出最终摘要：
   - 新版本和升级理由。
   - 标记为需要手动跟进的任何文件。
   - 建议的提交消息（例如，`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式和样式要求：

- 完全按照模板中的 Markdown 标题使用（不要降级/升级级别）。
- 换行长理由行以保持可读性（理想情况下 <100 字符），但不要强制使用尴尬的换行。
- 在部分之间保持单个空行。
- 避免尾随空格。

如果用户提供部分更新（例如，仅一个原则修订），仍然执行验证和版本决策步骤。

如果关键信息缺失（例如，批准日期确实未知），插入 `TODO(<FIELD_NAME>): 说明` 并在同步影响报告的延迟项目下包含。

不要创建新模板；始终对现有的 `/memory/constitution.md` 文件进行操作。
