---
description: 基于用户需求为当前功能生成自定义检查清单。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 检查清单目的："需求编写的单元测试"

**关键概念**：检查清单是**需求编写的单元测试** - 它们验证给定域中需求的质量、清晰度和完整性。

**不用于验证/测试**：

- ❌ 不是 "验证按钮是否正确点击"
- ❌ 不是 "测试错误处理是否有效"
- ❌ 不是 "确认 API 返回 200"
- ❌ 不是检查代码/实现是否与规范匹配


- ✅ "是否为所有卡片类型定义了视觉层级需求？"（完整性）
- ✅ "是否用特定的尺寸/定位量化了'突出显示'？"（清晰度）
- ✅ "是否在所有交互元素中一致地定义了悬停状态需求？"（一致性）
---
   - Infer any missing context from spec/plan/tasks (do NOT hallucinate)

4. **Load feature context**: Read from FEATURE_DIR:
   - spec.md: Feature requirements and scope
   - tasks.md (if exists): Implementation tasks

   **Context Loading Strategy**:
   - Load only necessary portions relevant to active focus areas (avoid full-file dumping)
   - Prefer summarizing long sections into concise scenario/requirement bullets
   - Create `FEATURE_DIR/checklists/` directory if it doesn't exist
   - 生成唯一的检查清单文件名：
     - Use short, descriptive name based on domain (e.g., `ux.md`, `api.md`, `security.md`)
     - Format: `[domain].md`
     - If file exists, append to existing file
   - Number items sequentially starting from CHK001
   - Each `/speckit.checklist` run creates a NEW file (never overwrites existing checklists)

   **CORE PRINCIPLE - 测试需求，而不是实现**：
   每个检查清单项必须评估**需求本身**是否满足：
   - **完整性**：是否存在所有必要的需求？
   - **清晰度**：需求是否明确且具体？
   - **一致性**：需求是否相互一致？
   - **可衡量性**：需求是否可以客观验证？
   - **覆盖范围**：是否覆盖了所有场景/边界情况？

   **类别结构** - 按需求质量维度分组项：
   - **需求完整性**（是否记录了所有必要的需求？）
   - **需求清晰度**（需求是否具体且明确？）
   - **需求一致性**（需求是否一致无冲突？）
   - **验收标准质量**（成功标准是否可衡量？）
   - **场景覆盖**（是否覆盖了所有流程/用例？）
   - **边界情况覆盖**（是否定义了边界条件？）
   - **非功能需求**（性能、安全性、可访问性等 - 是否已指定？）
   - **依赖关系和假设**（是否已记录和验证？）
   - **歧义和冲突**（什么需要澄清？）

   ❌ **错误示例**（测试实现）：
   - "确认标志点击导航到主页"

   - "是否指定了精选剧集的确切数量和布局？"[完整性]
   - "是否用特定的尺寸/定位量化了'突出显示'？"[清晰度]
   - "是否为所有交互 UI 定义了键盘导航需求？"[覆盖]
   - "当标志图像加载失败时是否指定了后备行为？"[边界情况]
   - "规范是否定义了竞争 UI 元素的视觉层级？"[清晰度]

   - 询问需求质量的问题格式
   - 专注于规范/计划中**写入的**（或未写入的）内容
   - 在方括号中包含质量维度 [完整性/清晰度/一致性等]
   - 检查现有需求时参考规范部分 `[规范 §X.Y]`
   - 检查缺失需求时使用 `[缺口]` 标记

   **按质量维度的示例**：

   完整性：
   - "是否为所有 API 故障模式定义了错误处理需求？[缺口]"
   - "是否为所有交互元素指定了可访问性需求？[完整性]"
   - "是否为响应式布局定义了移动断点需求？[缺口]"

   清晰度：
   - "是否用特定的时间阈值量化了'快速加载'？[清晰度，规范 §NFR-2]"
   - "是否明确定义了'相关剧集'的选择标准？[清晰度，规范 §FR-5]"
   - "是否用可衡量的视觉属性定义了'突出'？[歧义，规范 §FR-4]"

   一致性：
   - "导航需求是否在所有页面上对齐？[一致性，规范 §FR-10]"
   - "卡片组件需求在登陆页和详情页之间是否一致？[一致性]"

   覆盖范围：
   - "是否为零状态场景（无剧集）定义了需求？[覆盖，边界情况]"
   - "是否处理了并发用户交互场景？[覆盖，缺口]"
   - "是否为部分数据加载失败指定了需求？[覆盖，异常流]"

   可衡量性：
   - "视觉层级需求是否可衡量/可测试？[验收标准，规范 §FR-1]"
   - "是否可以客观验证'平衡视觉权重'？[可衡量性，规范 §FR-2]"

   **场景分类和覆盖**（需求质量重点）：
   - 检查是否存在以下需求：主要、替代、异常/错误、恢复、非功能场景
   - 对于每个场景类别，询问："是否完整、清晰且一致地定义了[场景类型]需求？"
   - 如果场景类别缺失："是[场景类型]需求被故意排除还是缺失？[缺口]"
   - 当状态变更发生时包括恢复力/回滚："是否为迁移失败定义了回滚需求？[缺口]"

   **可追踪性要求**：
   - 最少要求：≥80% 的项**必须**包含至少一个可追踪性参考
   - 每个项应参考：规范部分 `[规范 §X.Y]`，或使用标记：`[缺口]`、`[歧义]`、`[冲突]`、`[假设]`
   - 如果不存在 ID 系统："是否建立了需求和验收标准 ID 方案？[可追踪性]"

   **发现和解决问题**（需求质量问题）：
   提出关于需求本身的问题：
   - 歧义："是否用特定指标量化了术语'快速'？[歧义，规范 §NFR-1]"
   - 冲突："导航需求在 §FR-10 和 §FR-10a 之间是否冲突？[冲突]"
   - 假设："'总是可用的播客 API' 假设是否已验证？[假设]"
   - 依赖关系："是否记录了外部播客 API 需求？[依赖关系，缺口]"
   - 缺失定义："'视觉层级'是否用可衡量标准定义？[缺口]"

   **内容整合**：
   - 软上限：如果候选项 > 40，按风险/影响优先级排序
   - 合并检查相同需求方面的重复项
   - 如果 >5 个低影响边界情况，创建一项："需求中是否处理了边界情况 X、Y、Z？[覆盖]"

   **🚫 绝对禁止** - 这些会使其成为实现测试，而不是需求测试：
   - ❌ 以 "验证"、"测试"、"确认"、"检查" + 实现行为开头的任何项
   - ❌ 代码执行、用户操作、系统行为的参考
   - ❌ "正确显示"、"正常工作"、"按预期运行"
   - ❌ "点击"、"导航"、"渲染"、"加载"、"执行"
   - ❌ 测试用例、测试计划、QA 程序
   - ❌ 实现细节（框架、API、算法）

   **✅ 必需模式** - 这些测试需求质量：
   - ✅ "是否为[场景]定义/指定/记录了[需求类型]？"
   - ✅ "是否用特定标准量化/澄清了[模糊术语]？"
   - ✅ "需求是否在[部分 A]和[部分 B]之间保持一致？"
   - ✅ "是否可以客观测量/验证[需求]？"
   - ✅ "需求中是否处理了[边界情况/场景]？"
   - ✅ "规范是否定义了[缺失方面]？"

6. **结构参考**：按照 `templates/checklist-template.md` 中的规范模板生成检查清单，包括标题、元部分、类别标题和 ID 格式。如果模板不可用，使用：H1 标题、目的/创建元行、`##` 类别部分包含 `- [ ] CHK### <需求项>` 行，全局递增 ID 从 CHK001 开始。

7. **报告**：输出创建的检查清单的完整路径、项数，并提醒用户每次运行都会创建新文件。总结：
   - 选择的焦点区域
   - 深度级别
   - 参与者/时间
   - 任何用户指定的必需项

**重要**：每次调用 `/speckit.checklist` 命令都会使用简洁、描述性的名称创建检查清单文件（除非文件已存在）。这允许：

- 多个不同类型的检查清单（例如 `ux.md`、`test.md`、`security.md`）
- 简洁、易记的文件名，表明检查清单用途
- 轻松识别和导航 `checklists/` 文件夹

为避免混乱，使用描述性类型并在完成时清理过时的检查清单。

## 检查清单类型示例和示例项

**UX 需求质量**：`ux.md`

示例项（测试需求，**不是实现**）：

- "视觉层级需求是否用可衡量标准定义？[清晰度，规范 §FR-1]"
- "是否明确指定了 UI 元素的数量和位置？[完整性，规范 §FR-1]"
- "交互状态需求（悬停、焦点、活动）是否一致地定义？[一致性]"
- "是否为所有交互元素指定了可访问性需求？[覆盖，缺口]"
- "图像加载失败时是否定义了后备行为？[边界情况，缺口]"
- "是否可以客观测量'突出显示'？[可衡量性，规范 §FR-4]"

**API 需求质量**：`api.md`

示例项：

- "是否为所有故障场景指定了错误响应格式？[完整性]"
- "速率限制需求是否用特定阈值量化？[清晰度]"
- "认证需求在所有端点上是否一致？[一致性]"
- "是否为外部依赖定义了重试/超时需求？[覆盖，缺口]"
- "版本化策略是否在需求中记录？[缺口]"

**性能需求质量**：`performance.md`

示例项：

- "性能需求是否用特定指标量化？[清晰度]"
- "是否为所有关键用户旅程定义了性能目标？[覆盖]"
- "不同负载条件下是否指定了性能需求？[完整性]"
- "性能需求是否可以客观测量？[可衡量性]"
- "高负载场景下是否定义了降级需求？[边界情况，缺口]"

**安全需求质量**：`security.md`

示例项：

- "是否为所有受保护资源指定了认证需求？[覆盖]"
- "是否为敏感信息定义了数据保护需求？[完整性]"
- "威胁模型是否已记录且需求与之对齐？[可追踪性]"
- "安全需求是否与合规义务一致？[一致性]"
- "是否定义了安全故障/泄露响应需求？[缺口，异常流]"

## 反面例子：不要做的事

**❌ 错误 - 这些测试实现，不是需求：**

```markdown
- [ ] CHK001 - 验证登陆页显示 3 个剧集卡片 [规范 §FR-001]
- [ ] CHK002 - 测试桌面悬停状态是否正常工作 [规范 §FR-003]
- [ ] CHK003 - 确认标志点击导航到主页 [规范 §FR-010]
- [ ] CHK004 - 检查相关剧集部分是否显示 3-5 个项目 [规范 §FR-005]
```

**✅ 正确 - 这些测试需求质量：**

```markdown
- [ ] CHK001 - 精选剧集的数量和布局是否明确指定？[完整性，规范 §FR-001]
- [ ] CHK002 - 所有交互元素的悬停状态需求是否一致地定义？[一致性，规范 §FR-003]
- [ ] CHK003 - 所有可点击品牌元素的导航需求是否清晰？[清晰度，规范 §FR-010]
- [ ] CHK004 - 相关剧集的选择标准是否已记录？[缺口，规范 §FR-005]
- [ ] CHK005 - 异步剧集数据的加载状态需求是否定义？[缺口]
- [ ] CHK006 - '视觉层级'需求是否可以客观测量？[可衡量性，规范 §FR-001]
```

**关键差异：**

- 错误：测试系统是否正常工作
- 正确：测试需求是否编写正确
- 错误：行为验证
- 正确：需求质量验证
- 错误："它是否做了 X？"
- 正确："X 是否清晰指定？"
